<!DOCTYPE html>
<html>
  <head>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
  </head>
  <body>
    <h2> Tarantool benchmarking </h2>
    <h4>Please, select tarantool versions interval</h4>
    
    <select id="firstVersionId" name="firstVersion">
      <option></option>
    </select>
    <select id="lastVersionId" name="lastVesrion">
      <option></option>
    </select>
    <script>
      var firstVersion = document.getElementById("firstVersionId");
      var lastVersion = document.getElementById("lastVersionId");
      $.get("/versionList",{},
        function(data) {
          var dt = JSON.parse(data);
          for (var i = 0; i < dt.length; i++) {
              firstVersion.options[firstVersion.options.length] = new Option(dt[i], dt[i]);
              lastVersion.options[lastVersion.options.length] = new Option(dt[i], dt[i]);
          }
        });
    </script>
    <input id="reloadId" type="submit" name="reload" value="reload">
    <div id="container" style="width:80%; height:600px;"></div>
    <script>
      function get_req(firstVersion, lastVersion) {
        $.get("/bench",{firstVersion: firstVersion, lastVersion: lastVersion },
          function(data) {
            var dt = JSON.parse(data);
            $("#container").highcharts({
              chart: {
                type: 'column',
            },
            title: {
                text:'Benchmark results' 
            },
            xAxis: {
                categories: dt.categories
            },
            yAxis: {
                title: {
                    text: 'rps'
                }
            },
            series: dt.series,
            });
          });
      };
      jQuery(document).ready(function($) {
        get_req();
        var elem = document.getElementById("reloadId");
        var firstVersion = document.getElementById("firstVersionId");
        var lastVersion = document.getElementById("lastVersionId");
        elem.onclick = function() {
          //alert(firstVersion.options[firstVersion.selectedIndex].value)
          if ( firstVersion.selectedIndex == 0 || lastVersion.selectedIndex == 0 ) {
            alert('You should choose versions interval');
            return;
          } 
          get_req(firstVersion.options[firstVersion.selectedIndex].value,
            lastVersion.options[lastVersion.selectedIndex].value);
        }
      });
    </script>
  </body>
</html>

